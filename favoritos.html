<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Favoritos — The Media Buyer Club</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    (function() {
      document.documentElement.style.opacity = '0';
      window._sb = supabase.createClient(
        'https://reyogxnhguludddatyja.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJleW9neG5oZ3VsdWRkZGF0eWphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MDcyMjMsImV4cCI6MjA4NzI4MzIyM30.ehSy3Kx38jKpNqU0xZZnxSlDGharwMReulpRT_-vlVI'
      );
      _sb.auth.getSession().then(function(r) {
        if (!r.data.session) {
          window.location.replace('login.html');
        } else {
          document.documentElement.style.transition = 'opacity 180ms';
          document.documentElement.style.opacity = '1';
        }
      });
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;600&family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      --blue:         #47B5FF;
      --teal:         #00D4C8;
      --dark-bg:      #07090F;
      --surface-1:    #0C0F1A;
      --surface-2:    #111520;
      --surface-3:    #181D2E;
      --surface-card: #131826;
      --orange:       #F5A623;
      --text-primary: #E8EDF5;
      --text-muted:   #5B647A;
      --text-dim:     #3A4259;
      --sidebar-w:    68px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      background-color: var(--dark-bg);
      color: var(--text-primary);
      font-family: 'Montserrat', sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.035'/%3E%3C/svg%3E");
      pointer-events: none; z-index: 9999; opacity: 0.6;
    }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--surface-3); border-radius: 2px; }

    /* ── Sidebar ── */
    .sidebar {
      position: fixed; top: 0; left: 0; bottom: 0;
      width: var(--sidebar-w);
      background: var(--surface-1);
      border-right: 1px solid rgba(71,181,255,.06);
      display: flex; flex-direction: column; align-items: center;
      padding: 20px 0 24px;
      z-index: 100;
      transition: width 280ms cubic-bezier(.4,0,.2,1);
      overflow: hidden;
    }
    .sidebar:hover {
      width: 220px;
      box-shadow: 4px 0 40px rgba(0,0,0,.6), 1px 0 0 rgba(71,181,255,.08);
    }

    .sidebar-logo {
      width: 100%; display: flex; align-items: center; justify-content: center;
      padding: 0 14px; margin-bottom: 32px; min-height: 48px;
    }
    .sidebar-logo img { width: 40px; min-width: 40px; object-fit: contain; }
    .sidebar-logo-text {
      margin-left: 12px; white-space: nowrap;
      font-family: 'Roboto Mono', monospace; font-size: 9px; font-weight: 500;
      letter-spacing: .15em; color: var(--teal); line-height: 1.4;
      opacity: 0; transition: opacity 200ms 80ms;
    }
    .sidebar:hover .sidebar-logo-text { opacity: 1; }

    .nav-section { width: 100%; flex: 1; display: flex; flex-direction: column; gap: 2px; padding: 0 10px; }

    .nav-item {
      display: flex; align-items: center; gap: 14px; padding: 10px;
      border-radius: 8px; cursor: pointer; position: relative;
      text-decoration: none; transition: background 200ms, color 200ms;
      color: var(--text-muted); white-space: nowrap;
    }
    .nav-item:hover { background: rgba(71,181,255,.07); color: var(--blue); }
    .nav-item.active { background: rgba(245,166,35,.08); color: var(--orange); }
    .nav-item.active::before {
      content: ''; position: absolute; left: -10px; top: 50%;
      transform: translateY(-50%); width: 3px; height: 20px;
      background: var(--orange); border-radius: 0 2px 2px 0;
      box-shadow: 0 0 10px var(--orange);
    }

    .nav-icon { width: 20px; height: 20px; min-width: 20px; display: flex; align-items: center; justify-content: center; }
    .nav-label {
      font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: 500;
      letter-spacing: .08em; opacity: 0; transition: opacity 200ms 60ms;
    }
    .sidebar:hover .nav-label { opacity: 1; }
    .nav-divider { width: calc(100% - 20px); height: 1px; background: rgba(71,181,255,.06); margin: 8px 10px; }
    .sidebar-bottom { width: 100%; padding: 0 10px; display: flex; flex-direction: column; gap: 2px; }

    /* ── Main ── */
    .main-wrap { margin-left: var(--sidebar-w); min-height: 100vh; }

    /* ── Top bar ── */
    .topbar {
      position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 60px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 40px; z-index: 90;
      background: rgba(7,9,15,.92);
      backdrop-filter: blur(16px);
      box-shadow: 0 1px 0 rgba(71,181,255,.07);
    }

    .topbar-title {
      display: flex; align-items: center; gap: 14px;
    }

    .topbar-accent {
      width: 3px; height: 20px; border-radius: 2px;
      background: linear-gradient(180deg, var(--orange), #FF6B35);
    }

    .topbar-heading {
      font-family: 'Montserrat', sans-serif; font-size: 15px; font-weight: 700;
      letter-spacing: -.01em; color: var(--text-primary);
    }

    .topbar-count {
      font-family: 'Roboto Mono', monospace; font-size: 10px; font-weight: 600;
      letter-spacing: .12em; padding: 3px 10px; border-radius: 100px;
      background: rgba(245,166,35,.1); color: var(--orange);
      border: 1px solid rgba(245,166,35,.2);
    }

    .topbar-right { display: flex; align-items: center; gap: 16px; }
    .icon-btn {
      width: 36px; height: 36px; border-radius: 8px;
      background: rgba(255,255,255,.04); border: 1px solid rgba(71,181,255,.08);
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      color: var(--text-muted); transition: background 200ms, color 200ms, border-color 200ms;
    }
    .icon-btn:hover { background: rgba(71,181,255,.08); color: var(--blue); border-color: rgba(71,181,255,.2); }

    .notif-btn { position: relative; }
    .notif-dot {
      position: absolute;
      top: 6px; right: 7px;
      width: 7px; height: 7px;
      background: var(--teal);
      border-radius: 50%;
      box-shadow: 0 0 8px var(--teal);
      border: 1.5px solid var(--dark-bg);
    }

    .avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: linear-gradient(135deg, #004098 0%, #00D4C8 100%);
      border: 2px solid rgba(0,212,200,.4);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Roboto Mono', monospace; font-size: 12px; font-weight: 600;
      color: #fff; cursor: pointer; box-shadow: 0 0 16px rgba(0,212,200,.2);
    }

    /* ── Content ── */
    .content {
      padding: 96px 64px 80px;
    }

    /* ── Section header ── */
    .section-header {
      display: flex; align-items: flex-end; justify-content: space-between;
      margin-bottom: 32px;
    }

    .section-label {
      font-family: 'Roboto Mono', monospace; font-size: 9px; font-weight: 600;
      letter-spacing: .18em; color: var(--orange); text-transform: uppercase;
      margin-bottom: 6px;
    }

    .section-title {
      font-family: 'Montserrat', sans-serif; font-size: 24px; font-weight: 800;
      letter-spacing: -.02em; color: var(--text-primary);
    }

    .section-desc {
      font-size: 13px; color: var(--text-muted); margin-top: 6px;
    }

    .clear-btn {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(239,68,68,.06); border: 1px solid rgba(239,68,68,.15);
      border-radius: 8px; padding: 8px 16px;
      font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: 500;
      letter-spacing: .08em; color: #F87171; cursor: pointer;
      transition: background 180ms, border-color 180ms;
    }
    .clear-btn:hover { background: rgba(239,68,68,.12); border-color: rgba(239,68,68,.3); }

    /* ── Cards grid ── */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    /* ── Video Card (same as index) ── */
    .vcard {
      border-radius: 10px;
      background: var(--surface-card);
      overflow: hidden;
      cursor: pointer;
      position: relative;
      border: 1px solid rgba(71,181,255,.06);
      transition: transform 280ms cubic-bezier(.4,0,.2,1), box-shadow 280ms, border-color 280ms;
      text-decoration: none;
      display: block;
    }
    .vcard:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 24px 48px rgba(0,0,0,.6), 0 0 0 1px rgba(71,181,255,.15), 0 0 30px rgba(0,212,200,.08);
      border-color: rgba(71,181,255,.2);
      z-index: 10;
    }

    .vcard-thumb {
      position: relative; width: 100%; aspect-ratio: 16/9;
      overflow: hidden; background: var(--surface-2);
    }
    .vcard-thumb img {
      width: 100%; height: 100%; object-fit: cover;
      transition: transform 400ms cubic-bezier(.4,0,.2,1), filter 400ms;
      filter: saturate(0.85);
    }
    .vcard:hover .vcard-thumb img { transform: scale(1.08); filter: saturate(1); }

    .vcard-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(180deg, transparent 30%, rgba(7,9,15,.8) 100%);
      opacity: 0; transition: opacity 280ms;
      display: flex; align-items: center; justify-content: center;
    }
    .vcard:hover .vcard-overlay { opacity: 1; }

    .play-btn {
      width: 48px; height: 48px; border-radius: 50%;
      background: rgba(0,212,200,.9); border: none;
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      box-shadow: 0 0 24px rgba(0,212,200,.5);
      transform: scale(.85); transition: transform 200ms, background 200ms;
    }
    .vcard:hover .play-btn { transform: scale(1); }

    .vcard-body { padding: 14px 16px 16px; }

    .vcard-cat {
      font-family: 'Roboto Mono', monospace; font-size: 9px; font-weight: 600;
      letter-spacing: .15em; color: var(--teal); text-transform: uppercase; margin-bottom: 6px;
    }

    .vcard-title {
      font-family: 'Montserrat', sans-serif; font-size: 13px; font-weight: 700;
      line-height: 1.4; color: var(--text-primary); margin-bottom: 8px;
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }

    .vcard-meta {
      display: flex; align-items: center; gap: 12px;
    }
    .vcard-meta-item {
      display: flex; align-items: center; gap: 5px;
      font-family: 'Roboto Mono', monospace; font-size: 10px; color: var(--text-muted);
    }

    /* Remove from favorites button (top-right of card) */
    .remove-fav {
      position: absolute; top: 8px; right: 8px; z-index: 20;
      width: 28px; height: 28px; border-radius: 50%;
      background: rgba(0,0,0,.6); border: 1px solid rgba(245,166,35,.35);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: var(--orange);
      opacity: 0; transition: opacity 180ms, background 180ms;
    }
    .vcard:hover .remove-fav { opacity: 1; }
    .remove-fav:hover { background: rgba(239,68,68,.25); border-color: rgba(239,68,68,.5); color: #F87171; }

    /* ── Empty state ── */
    .empty-state {
      grid-column: 1 / -1;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 80px 40px;
      border: 1px dashed rgba(71,181,255,.1);
      border-radius: 16px;
      text-align: center;
    }

    .empty-icon {
      width: 64px; height: 64px; border-radius: 50%;
      background: rgba(245,166,35,.06); border: 1px solid rgba(245,166,35,.12);
      display: flex; align-items: center; justify-content: center;
      color: var(--orange); opacity: .6;
      margin-bottom: 20px;
    }

    .empty-title {
      font-family: 'Montserrat', sans-serif; font-size: 18px; font-weight: 700;
      color: var(--text-primary); margin-bottom: 8px;
    }

    .empty-desc {
      font-size: 13px; color: var(--text-muted); max-width: 380px; line-height: 1.6;
      margin-bottom: 28px;
    }

    .empty-cta {
      display: inline-flex; align-items: center; gap: 10px;
      background: rgba(0,212,200,.1); border: 1px solid rgba(0,212,200,.25);
      border-radius: 8px; padding: 11px 24px;
      font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: 600;
      letter-spacing: .1em; color: var(--teal); text-decoration: none;
      transition: background 180ms, border-color 180ms;
    }
    .empty-cta:hover { background: rgba(0,212,200,.18); border-color: rgba(0,212,200,.4); }

    @keyframes fade-up {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-up { animation: fade-up 400ms cubic-bezier(.4,0,.2,1) both; }
  </style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <img src="brand_assets/logo-transparent.png" alt="MBC Logo" />
    <div class="sidebar-logo-text">THE MEDIA<br>BUYER CLUB</div>
  </div>

  <nav class="nav-section">
    <a class="nav-item" href="index.html">
      <span class="nav-icon">
        <svg width="18" height="18" fill="none" viewBox="0 0 24 24">
          <rect x="2" y="2" width="9" height="9" rx="2" fill="currentColor" opacity=".7"/>
          <rect x="13" y="2" width="9" height="9" rx="2" fill="currentColor"/>
          <rect x="2" y="13" width="9" height="9" rx="2" fill="currentColor" opacity=".4"/>
          <rect x="13" y="13" width="9" height="9" rx="2" fill="currentColor" opacity=".7"/>
        </svg>
      </span>
      <span class="nav-label">HUB DE VÍDEOS</span>
    </a>

    <a class="nav-item active" href="favoritos.html">
      <span class="nav-icon">
        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 21l-7.5-7.2A5 5 0 0 1 12 6.5a5 5 0 0 1 7.5 7.3L12 21z"/>
        </svg>
      </span>
      <span class="nav-label">FAVORITOS</span>
    </a>
  </nav>

  <div class="sidebar-bottom">
    <div class="nav-divider"></div>
    <a class="nav-item" href="#">
      <span class="nav-icon">
        <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="nav-label">CONFIGURAÇÕES</span>
    </a>
  </div>
</aside>

<!-- MAIN -->
<div class="main-wrap">

  <header class="topbar">
    <div class="topbar-title">
      <div class="topbar-accent"></div>
      <span class="topbar-heading">Meus Favoritos</span>
      <span class="topbar-count" id="fav-count">0 vídeos</span>
    </div>
    <div class="topbar-right">
      <div class="icon-btn notif-btn">
        <div class="notif-dot"></div>
        <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="avatar">RQ</div>
    </div>
  </header>

  <div class="content">

    <div class="section-header fade-up">
      <div>
        <div class="section-label">Coleção Pessoal</div>
        <div class="section-title">Vídeos Salvos</div>
        <div class="section-desc">Vídeos que você marcou como favorito no player.</div>
      </div>
      <button class="clear-btn" id="btn-clear-all" style="display:none;">
        <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.2">
          <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round"/>
        </svg>
        LIMPAR TUDO
      </button>
    </div>

    <div class="cards-grid fade-up" id="cards-grid">
      <!-- populated by JS -->
    </div>

  </div>
</div>

<script>
  // ── Catalog (same source as player.html & index.html) ──
  const CATALOG = [
    {
      id: 'x8_ZM5Ih_mg',
      title: 'Blueprint de Anúncios 7 Dígitos no Meta',
      cat: 'Meta Ads · Avançado',
      duration: '1h 05min',
    },
    {
      id: 'X_Wp8CBMSWQ',
      title: 'Broad Targeting em 2025: Por que Funciona',
      cat: 'Meta Ads · Intermediário',
      duration: '58min',
    },
  ];

  // ── Favorites helpers ──────────────────────────────────
  const LS_KEY = 'mbc_favorites';
  function getFavs() { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); }
  function setFavs(arr) { localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

  function removeFav(id) {
    const favs = getFavs().filter(f => f !== id);
    setFavs(favs);
    renderCards();
  }

  // ── Render ─────────────────────────────────────────────
  const grid = document.getElementById('cards-grid');
  const countEl = document.getElementById('fav-count');
  const clearBtn = document.getElementById('btn-clear-all');

  function renderCards() {
    const favIds = getFavs();
    const favVideos = favIds
      .map(id => CATALOG.find(v => v.id === id))
      .filter(Boolean);

    // Update count
    countEl.textContent = favVideos.length + ' vídeo' + (favVideos.length !== 1 ? 's' : '');
    clearBtn.style.display = favVideos.length ? 'inline-flex' : 'none';

    grid.innerHTML = '';

    if (favVideos.length === 0) {
      grid.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">
            <svg width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
              <path d="M12 21l-7.5-7.2A5 5 0 0 1 12 6.5a5 5 0 0 1 7.5 7.3L12 21z" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="empty-title">Nenhum vídeo salvo ainda</div>
          <div class="empty-desc">
            Ao assistir um vídeo, clique em <strong style="color:var(--orange);">SALVAR</strong> para adicioná-lo aqui e acessar rapidamente depois.
          </div>
          <a class="empty-cta" href="index.html">
            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.2">
              <rect x="2" y="2" width="9" height="9" rx="2" fill="currentColor" opacity=".7" stroke="none"/>
              <rect x="13" y="2" width="9" height="9" rx="2" fill="currentColor" stroke="none"/>
              <rect x="2" y="13" width="9" height="9" rx="2" fill="currentColor" opacity=".4" stroke="none"/>
              <rect x="13" y="13" width="9" height="9" rx="2" fill="currentColor" opacity=".7" stroke="none"/>
            </svg>
            EXPLORAR HUB DE VÍDEOS
          </a>
        </div>`;
      return;
    }

    favVideos.forEach(v => {
      const thumb = `https://img.youtube.com/vi/${v.id}/maxresdefault.jpg`;
      const fallback = `https://img.youtube.com/vi/${v.id}/hqdefault.jpg`;
      grid.innerHTML += `
        <div class="vcard" style="position:relative;">
          <!-- Remove button -->
          <button class="remove-fav" onclick="event.preventDefault(); removeFav('${v.id}')" title="Remover dos favoritos">
            <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 21l-7.5-7.2A5 5 0 0 1 12 6.5a5 5 0 0 1 7.5 7.3L12 21z"/>
            </svg>
          </button>

          <a href="player.html?v=${v.id}" style="text-decoration:none; display:contents;">
            <div class="vcard-thumb">
              <img src="${thumb}" alt="${v.title}" onerror="this.src='${fallback}'" />
              <div class="vcard-overlay">
                <button class="play-btn">
                  <svg width="20" height="20" fill="#050810" viewBox="0 0 24 24"><path d="M5 3l14 9-14 9V3z"/></svg>
                </button>
              </div>
            </div>
            <div class="vcard-body">
              <div class="vcard-cat">${v.cat}</div>
              <div class="vcard-title">${v.title}</div>
              <div class="vcard-meta">
                <span class="vcard-meta-item">
                  <svg width="11" height="11" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M12 8v4l2 2" stroke-linecap="round"/>
                  </svg>
                  ${v.duration}
                </span>
                <span class="vcard-meta-item" style="margin-left:auto; color:var(--orange);">
                  <svg width="10" height="10" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 21l-7.5-7.2A5 5 0 0 1 12 6.5a5 5 0 0 1 7.5 7.3L12 21z"/>
                  </svg>
                  SALVO
                </span>
              </div>
            </div>
          </a>
        </div>`;
    });
  }

  clearBtn.addEventListener('click', () => {
    setFavs([]);
    renderCards();
  });

  // Initial render
  renderCards();

  // ── Notifications ──────────────────────────────────────
  (function initNotifications() {
    const NOTIF_KEY = 'mbc_notif_read';
    const notifBtn  = document.querySelector('.notif-btn');
    const notifDot  = notifBtn.querySelector('.notif-dot');
    const notifRead = JSON.parse(localStorage.getItem(NOTIF_KEY) || '[]');
    const unreadIds = CATALOG.map(v => v.id).filter(id => !notifRead.includes(id));

    notifDot.style.display = unreadIds.length > 0 ? '' : 'none';

    const dd = document.createElement('div');
    dd.id = 'notif-dropdown';
    dd.style.cssText = [
      'display:none','position:absolute','top:calc(100% + 10px)','right:0',
      'width:320px','background:var(--surface-2)',
      'border:1px solid rgba(71,181,255,.14)','border-radius:10px',
      'box-shadow:0 20px 56px rgba(0,0,0,.75),0 0 0 1px rgba(0,212,200,.04)',
      'z-index:500','overflow:hidden',
    ].join(';');

    let html = `
      <div style="padding:14px 16px 10px;border-bottom:1px solid rgba(71,181,255,.07);display:flex;align-items:center;gap:8px;">
        <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="var(--teal)" stroke-width="2" style="flex-shrink:0;"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span style="font-family:'Roboto Mono',monospace;font-size:10px;font-weight:600;letter-spacing:.12em;color:var(--text-muted);flex:1;">NOTIFICAÇÕES</span>
        <button id="notif-mark-all" style="font-family:'Roboto Mono',monospace;font-size:9px;color:var(--teal);cursor:pointer;letter-spacing:.1em;background:none;border:none;padding:0;">MARCAR LIDAS</button>
      </div>
      <div style="max-height:340px;overflow-y:auto;">`;

    CATALOG.slice().reverse().forEach(v => {
      const isUnread = !notifRead.includes(v.id);
      const thumb    = `https://img.youtube.com/vi/${v.id}/hqdefault.jpg`;
      html += `
        <a href="player.html?v=${v.id}" data-nid="${v.id}"
           style="display:flex;align-items:center;gap:12px;padding:11px 16px;border-bottom:1px solid rgba(71,181,255,.05);text-decoration:none;background:${isUnread ? 'rgba(0,212,200,.035)' : 'transparent'};transition:background 150ms;"
           onmouseover="this.style.background='rgba(71,181,255,.06)'"
           onmouseout="this.style.background='${isUnread ? 'rgba(0,212,200,.035)' : 'transparent'}'">
          <div style="width:60px;min-width:60px;height:34px;border-radius:4px;overflow:hidden;background:var(--surface-3);">
            <img src="${thumb}" style="width:100%;height:100%;object-fit:cover;" onerror="this.parentElement.style.background='var(--surface-3)'" />
          </div>
          <div style="flex:1;min-width:0;">
            <div style="font-family:'Roboto Mono',monospace;font-size:8px;font-weight:700;letter-spacing:.14em;color:var(--teal);margin-bottom:3px;">NOVO VÍDEO</div>
            <div style="font-family:'Montserrat',sans-serif;font-size:12px;font-weight:600;color:var(--text-primary);line-height:1.3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${v.title}</div>
            <div style="font-family:'Roboto Mono',monospace;font-size:9px;color:var(--text-muted);margin-top:2px;">${v.cat}</div>
          </div>
          ${isUnread ? '<div style="width:7px;height:7px;border-radius:50%;background:var(--teal);box-shadow:0 0 8px var(--teal);flex-shrink:0;"></div>' : ''}
        </a>`;
    });

    html += '</div>';
    dd.innerHTML = html;
    notifBtn.appendChild(dd);

    let open = false;
    notifBtn.addEventListener('click', e => {
      e.stopPropagation();
      open = !open;
      dd.style.display = open ? 'block' : 'none';
    });
    document.addEventListener('click', e => {
      if (!notifBtn.contains(e.target)) { open = false; dd.style.display = 'none'; }
    });
    dd.querySelector('#notif-mark-all').addEventListener('click', e => {
      e.stopPropagation();
      localStorage.setItem(NOTIF_KEY, JSON.stringify(CATALOG.map(v => v.id)));
      notifDot.style.display = 'none';
      dd.querySelectorAll('[data-nid]').forEach(el => {
        el.style.background = 'transparent';
        el.onmouseout = () => { el.style.background = 'transparent'; };
        const dot = el.querySelector('div[style*="border-radius:50%"]');
        if (dot) dot.remove();
      });
    });
    dd.querySelectorAll('[data-nid]').forEach(el => {
      el.addEventListener('click', () => {
        const id   = el.dataset.nid;
        const read = JSON.parse(localStorage.getItem(NOTIF_KEY) || '[]');
        if (!read.includes(id)) { read.push(id); localStorage.setItem(NOTIF_KEY, JSON.stringify(read)); }
        if (CATALOG.every(v => read.includes(v.id))) notifDot.style.display = 'none';
      });
    });
  })();

  // ── Avatar: usuário real + logout ─────────────────────
  (async function initAvatar() {
    const avatar = document.querySelector('.avatar');
    if (!avatar) return;
    const { data: { user } } = await _sb.auth.getUser();
    if (user) {
      const initials = (user.user_metadata?.full_name || user.email).slice(0, 2).toUpperCase();
      avatar.textContent = initials;
    }
    avatar.style.cssText += ';position:relative;cursor:pointer;';

    const dd = document.createElement('div');
    dd.style.cssText = 'display:none;position:absolute;top:calc(100% + 8px);right:0;background:#111520;border:1px solid rgba(71,181,255,.12);border-radius:10px;box-shadow:0 16px 48px rgba(0,0,0,.7);z-index:500;min-width:210px;overflow:hidden;';
    dd.innerHTML = `
      <div style="padding:12px 16px;border-bottom:1px solid rgba(71,181,255,.07);">
        <div style="font-family:'Roboto Mono',monospace;font-size:9px;letter-spacing:.1em;color:#5B647A;margin-bottom:4px;">CONECTADO COMO</div>
        <div style="font-family:'Montserrat',sans-serif;font-size:12px;font-weight:600;color:#E8EDF5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${user ? user.email : ''}</div>
      </div>
      <button id="avatarLogoutBtn" style="width:100%;padding:12px 16px;background:none;border:none;display:flex;align-items:center;gap:10px;cursor:pointer;color:#FF8FA3;font-family:'Roboto Mono',monospace;font-size:10px;letter-spacing:.1em;" onmouseover="this.style.background='rgba(255,77,106,.06)'" onmouseout="this.style.background='none'">
        <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke-linecap="round" stroke-linejoin="round"/></svg>
        SAIR DA CONTA
      </button>`;
    avatar.appendChild(dd);

    let open = false;
    avatar.addEventListener('click', e => { e.stopPropagation(); open = !open; dd.style.display = open ? 'block' : 'none'; });
    document.addEventListener('click', () => { open = false; dd.style.display = 'none'; });
    dd.querySelector('#avatarLogoutBtn').addEventListener('click', async () => {
      await _sb.auth.signOut();
      window.location.replace('login.html');
    });
  })();
</script>

</body>
</html>
