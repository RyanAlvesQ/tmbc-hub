<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Player — The Media Buyer Club</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    (function() {
      document.documentElement.style.opacity = '0';
      window._sb = supabase.createClient(
        'https://reyogxnhguludddatyja.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJleW9neG5oZ3VsdWRkZGF0eWphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MDcyMjMsImV4cCI6MjA4NzI4MzIyM30.ehSy3Kx38jKpNqU0xZZnxSlDGharwMReulpRT_-vlVI'
      );
      _sb.auth.getSession().then(function(r) {
        if (!r.data.session) {
          window.location.replace('login.html');
        } else {
          document.documentElement.style.transition = 'opacity 180ms';
          document.documentElement.style.opacity = '1';
        }
      });
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;600&family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      --blue:         #47B5FF;
      --blue-glow:    rgba(71,181,255,.25);
      --teal:         #00D4C8;
      --teal-glow:    rgba(0,212,200,.2);
      --dark-bg:      #07090F;
      --surface-1:    #0C0F1A;
      --surface-2:    #111520;
      --surface-3:    #181D2E;
      --surface-card: #131826;
      --orange:       #F5A623;
      --text-primary: #E8EDF5;
      --text-muted:   #5B647A;
      --text-dim:     #3A4259;
      --sidebar-w:    68px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      background-color: var(--dark-bg);
      color: var(--text-primary);
      font-family: 'Montserrat', sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Noise texture */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.035'/%3E%3C/svg%3E");
      pointer-events: none; z-index: 9999; opacity: 0.6;
    }

    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--surface-3); border-radius: 2px; }

    /* ── Sidebar ── */
    .sidebar {
      position: fixed; top: 0; left: 0; bottom: 0;
      width: var(--sidebar-w);
      background: var(--surface-1);
      border-right: 1px solid rgba(71,181,255,.06);
      display: flex; flex-direction: column; align-items: center;
      padding: 20px 0 24px;
      z-index: 100;
      transition: width 280ms cubic-bezier(.4,0,.2,1);
      overflow: hidden;
    }
    .sidebar:hover {
      width: 220px;
      box-shadow: 4px 0 40px rgba(0,0,0,.6), 1px 0 0 rgba(71,181,255,.08);
    }

    .sidebar-logo {
      width: 100%; display: flex; align-items: center; justify-content: center;
      padding: 0 14px; margin-bottom: 32px; min-height: 48px;
    }
    .sidebar-logo img { width: 40px; min-width: 40px; object-fit: contain; }
    .sidebar-logo-text {
      margin-left: 12px; white-space: nowrap;
      font-family: 'Roboto Mono', monospace; font-size: 9px; font-weight: 500;
      letter-spacing: .15em; color: var(--teal); line-height: 1.4;
      opacity: 0; transition: opacity 200ms 80ms;
    }
    .sidebar:hover .sidebar-logo-text { opacity: 1; }

    .nav-section {
      width: 100%; flex: 1; display: flex; flex-direction: column;
      gap: 2px; padding: 0 10px;
    }

    .nav-item {
      display: flex; align-items: center; gap: 14px; padding: 10px;
      border-radius: 8px; cursor: pointer; position: relative;
      text-decoration: none; transition: background 200ms, color 200ms;
      color: var(--text-muted); white-space: nowrap;
    }
    .nav-item:hover { background: rgba(71,181,255,.07); color: var(--blue); }
    .nav-item.active { background: rgba(0,212,200,.1); color: var(--teal); }
    .nav-item.active::before {
      content: ''; position: absolute; left: -10px; top: 50%;
      transform: translateY(-50%); width: 3px; height: 20px;
      background: var(--teal); border-radius: 0 2px 2px 0;
      box-shadow: 0 0 10px var(--teal);
    }

    .nav-icon { width: 20px; height: 20px; min-width: 20px; display: flex; align-items: center; justify-content: center; }
    .nav-label {
      font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: 500;
      letter-spacing: .08em; opacity: 0; transition: opacity 200ms 60ms;
    }
    .sidebar:hover .nav-label { opacity: 1; }
    .nav-divider {
      width: calc(100% - 20px); height: 1px;
      background: rgba(71,181,255,.06); margin: 8px 10px;
    }

    .sidebar-bottom { width: 100%; padding: 0 10px; display: flex; flex-direction: column; gap: 2px; }

    /* ── Main layout ── */
    .main-wrap { margin-left: var(--sidebar-w); min-height: 100vh; display: flex; flex-direction: column; }

    /* ── Top bar ── */
    .topbar {
      position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: 60px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 32px; z-index: 90;
      background: rgba(7,9,15,.92);
      backdrop-filter: blur(16px);
      box-shadow: 0 1px 0 rgba(71,181,255,.07);
    }

    .topbar-left { display: flex; align-items: center; gap: 16px; }

    .back-btn {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(71,181,255,.1);
      border-radius: 8px; padding: 7px 14px;
      font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: 500;
      letter-spacing: .08em; color: var(--text-muted); cursor: pointer;
      text-decoration: none;
      transition: background 200ms, color 200ms, border-color 200ms;
    }
    .back-btn:hover { background: rgba(71,181,255,.08); color: var(--blue); border-color: rgba(71,181,255,.2); }

    .topbar-breadcrumb {
      font-family: 'Roboto Mono', monospace; font-size: 11px;
      color: var(--text-dim); letter-spacing: .06em;
      display: flex; align-items: center; gap: 8px;
    }
    .topbar-breadcrumb span { color: var(--text-muted); }

    .topbar-right { display: flex; align-items: center; gap: 16px; }

    .icon-btn {
      width: 36px; height: 36px; border-radius: 8px;
      background: rgba(255,255,255,.04); border: 1px solid rgba(71,181,255,.08);
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      color: var(--text-muted); transition: background 200ms, color 200ms, border-color 200ms;
    }
    .icon-btn:hover { background: rgba(71,181,255,.08); color: var(--blue); border-color: rgba(71,181,255,.2); }

    .notif-btn { position: relative; }
    .notif-dot {
      position: absolute;
      top: 6px; right: 7px;
      width: 7px; height: 7px;
      background: var(--teal);
      border-radius: 50%;
      box-shadow: 0 0 8px var(--teal);
      border: 1.5px solid var(--dark-bg);
    }

    .avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: linear-gradient(135deg, #004098 0%, #00D4C8 100%);
      border: 2px solid rgba(0,212,200,.4);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Roboto Mono', monospace; font-size: 12px; font-weight: 600;
      color: #fff; cursor: pointer; box-shadow: 0 0 16px rgba(0,212,200,.2);
    }

    /* ── Player Page Layout ── */
    .player-page {
      padding-top: 60px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .player-main {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 0;
      flex: 1;
    }

    /* ── Video Column ── */
    .video-col {
      display: flex;
      flex-direction: column;
      padding: 32px 28px 40px 40px;
    }

    .video-wrapper {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      box-shadow:
        0 32px 64px rgba(0,0,0,.7),
        0 0 0 1px rgba(71,181,255,.08),
        0 0 60px rgba(0,212,200,.04);
      position: relative;
    }

    .video-wrapper iframe,
    .video-wrapper #yt-player iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100% !important; height: 100% !important;
      border: none; display: block;
    }

    /* Video info below player */
    .video-info {
      margin-top: 24px;
      padding: 0 4px;
    }

    .video-tag {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(0,212,200,.1); border: 1px solid rgba(0,212,200,.2);
      border-radius: 4px; padding: 4px 10px;
      font-family: 'Roboto Mono', monospace; font-size: 9px; font-weight: 600;
      letter-spacing: .14em; color: var(--teal);
      margin-bottom: 14px;
    }

    .video-title {
      font-family: 'Montserrat', sans-serif;
      font-size: 22px; font-weight: 800;
      line-height: 1.25; letter-spacing: -.02em;
      color: var(--text-primary);
      margin-bottom: 14px;
    }

    .video-meta-row {
      display: flex; align-items: center; gap: 20px;
      margin-bottom: 20px;
    }

    .video-meta-item {
      display: flex; align-items: center; gap: 6px;
      font-family: 'Roboto Mono', monospace; font-size: 11px;
      color: var(--text-muted); letter-spacing: .04em;
    }

    .video-actions {
      display: flex; align-items: center; gap: 12px;
      padding-top: 20px;
      border-top: 1px solid rgba(71,181,255,.06);
    }

    .action-btn {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(255,255,255,.05); border: 1px solid rgba(71,181,255,.1);
      border-radius: 8px; padding: 9px 18px;
      font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: 500;
      letter-spacing: .08em; color: var(--text-muted); cursor: pointer;
      transition: background 180ms, color 180ms, border-color 180ms;
    }
    .action-btn:hover { background: rgba(71,181,255,.08); color: var(--blue); border-color: rgba(71,181,255,.2); }

    /* Save button states */
    .action-btn.fav:hover { background: rgba(245,166,35,.08); color: var(--orange); border-color: rgba(245,166,35,.2); }
    .action-btn.fav.saved {
      color: var(--orange);
      border-color: rgba(245,166,35,.35);
      background: rgba(245,166,35,.08);
    }
    .action-btn.fav.saved svg { fill: currentColor; }

    /* Nav prev/next buttons — pushed to the right */
    .nav-spacer { flex: 1; }
    .action-btn.nav-btn {
      border-color: rgba(71,181,255,.12);
    }
    .action-btn.nav-btn:hover { background: rgba(0,212,200,.08); color: var(--teal); border-color: rgba(0,212,200,.25); }

    /* ── Playlist Column (right) ── */
    .playlist-col {
      background: var(--surface-1);
      border-left: 1px solid rgba(71,181,255,.06);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .playlist-header {
      display: flex; align-items: center; gap: 10px;
      padding: 24px 20px 16px;
      border-bottom: 1px solid rgba(71,181,255,.06);
      flex-shrink: 0;
    }

    .playlist-accent {
      width: 3px; height: 16px; border-radius: 2px;
      background: linear-gradient(180deg, var(--teal), var(--blue));
    }

    .playlist-title {
      font-family: 'Roboto Mono', monospace; font-size: 11px; font-weight: 600;
      letter-spacing: .12em; color: var(--text-muted); text-transform: uppercase;
      flex: 1;
    }

    .playlist-count {
      font-family: 'Roboto Mono', monospace; font-size: 10px;
      color: var(--text-dim); letter-spacing: .08em;
    }

    .playlist-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px 12px 24px;
    }

    /* Playlist item */
    .pitem {
      display: flex; gap: 12px; padding: 10px 8px;
      border-radius: 8px; cursor: pointer;
      transition: background 180ms;
      text-decoration: none;
      position: relative;
    }
    .pitem:hover { background: rgba(71,181,255,.05); }
    .pitem.active {
      background: rgba(0,212,200,.07);
      border: 1px solid rgba(0,212,200,.12);
    }

    .pitem-num {
      width: 20px; min-width: 20px; padding-top: 2px;
      font-family: 'Roboto Mono', monospace; font-size: 10px;
      color: var(--text-dim); text-align: center;
    }
    .pitem.active .pitem-num { color: var(--teal); }

    .pitem-thumb {
      width: 100px; min-width: 100px; aspect-ratio: 16/9;
      border-radius: 5px; overflow: hidden; background: var(--surface-2);
      position: relative;
    }
    .pitem-thumb img { width: 100%; height: 100%; object-fit: cover; }

    .pitem-now {
      position: absolute; inset: 0;
      background: rgba(0,0,0,.5);
      display: flex; align-items: center; justify-content: center;
    }
    .pitem-now-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--teal);
      box-shadow: 0 0 10px var(--teal);
      animation: pulse-dot 1.5s ease-in-out infinite;
    }
    @keyframes pulse-dot { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(.7)} }

    .pitem-info { flex: 1; display: flex; flex-direction: column; gap: 3px; min-width: 0; }
    .pitem-cat {
      font-family: 'Roboto Mono', monospace; font-size: 8px; font-weight: 600;
      letter-spacing: .14em; color: var(--teal); text-transform: uppercase;
    }
    .pitem-title {
      font-family: 'Montserrat', sans-serif; font-size: 12px; font-weight: 600;
      line-height: 1.35; color: var(--text-primary);
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    .pitem.active .pitem-title { color: #fff; }
    .pitem-dur {
      font-family: 'Roboto Mono', monospace; font-size: 9px;
      color: var(--text-muted);
    }

    /* Loading state */
    .video-loading {
      position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
      background: var(--surface-2); border-radius: 12px;
    }
    .loading-spinner {
      width: 40px; height: 40px; border-radius: 50%;
      border: 2px solid rgba(71,181,255,.1);
      border-top-color: var(--teal);
      animation: spin 700ms linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @keyframes fade-up {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-up { animation: fade-up 400ms cubic-bezier(.4,0,.2,1) both; }
    .fade-up-1 { animation-delay: 80ms; }
    .fade-up-2 { animation-delay: 160ms; }
  </style>
</head>
<body>

<!-- ═══════════════════════════════════════
     SIDEBAR
══════════════════════════════════════════ -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <img src="brand_assets/logo-transparent.png" alt="MBC Logo" />
    <div class="sidebar-logo-text">THE MEDIA<br>BUYER CLUB</div>
  </div>

  <nav class="nav-section">
    <a class="nav-item active" href="index.html">
      <span class="nav-icon">
        <svg width="18" height="18" fill="none" viewBox="0 0 24 24">
          <rect x="2" y="2" width="9" height="9" rx="2" fill="currentColor" opacity=".7"/>
          <rect x="13" y="2" width="9" height="9" rx="2" fill="currentColor"/>
          <rect x="2" y="13" width="9" height="9" rx="2" fill="currentColor" opacity=".4"/>
          <rect x="13" y="13" width="9" height="9" rx="2" fill="currentColor" opacity=".7"/>
        </svg>
      </span>
      <span class="nav-label">HUB DE VÍDEOS</span>
    </a>

    <a class="nav-item" href="favoritos.html">
      <span class="nav-icon">
        <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path d="M12 21l-7.5-7.2A5 5 0 0 1 12 6.5a5 5 0 0 1 7.5 7.3L12 21z" stroke-linejoin="round"/>
        </svg>
      </span>
      <span class="nav-label">FAVORITOS</span>
    </a>
  </nav>

  <div class="sidebar-bottom">
    <div class="nav-divider"></div>
    <a class="nav-item" href="#">
      <span class="nav-icon">
        <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="nav-label">CONFIGURAÇÕES</span>
    </a>
  </div>
</aside>

<!-- ═══════════════════════════════════════
     MAIN WRAPPER
══════════════════════════════════════════ -->
<div class="main-wrap">

  <!-- Top Bar -->
  <header class="topbar">
    <div class="topbar-left">
      <a class="back-btn" href="index.html">
        <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path d="M19 12H5M12 19l-7-7 7-7" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        HUB
      </a>
      <div class="topbar-breadcrumb">
        NOVOS VÍDEOS <span style="color:var(--text-dim);">›</span> <span id="breadcrumb-title">Carregando...</span>
      </div>
    </div>

    <div class="topbar-right">
      <div class="icon-btn notif-btn">
        <div class="notif-dot"></div>
        <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="avatar">RQ</div>
    </div>
  </header>

  <!-- Player Page -->
  <div class="player-page">
    <div class="player-main">

      <!-- Video Column -->
      <div class="video-col">

        <div class="video-wrapper fade-up" id="video-container">
          <div class="video-loading" id="video-loading">
            <div class="loading-spinner"></div>
          </div>
          <!-- YT IFrame API injects the iframe inside this div -->
          <div id="yt-player" style="width:100%;height:100%;"></div>
        </div>

        <!-- Completed Banner (shown when video finishes) -->
        <div id="completed-banner" style="display:none;align-items:center;gap:14px;margin-top:16px;padding:14px 20px;background:rgba(74,222,128,.07);border:1px solid rgba(74,222,128,.2);border-radius:8px;">
          <div style="width:34px;height:34px;border-radius:50%;background:rgba(74,222,128,.15);border:1px solid rgba(74,222,128,.3);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#4ADE80" stroke-width="2.5"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div>
            <div style="font-family:'Roboto Mono',monospace;font-size:12px;font-weight:700;letter-spacing:.1em;color:#4ADE80;">VÍDEO CONCLUÍDO</div>
            <div style="font-family:'Roboto Mono',monospace;font-size:10px;color:var(--text-muted);margin-top:3px;">Este vídeo foi marcado como assistido no seu histórico.</div>
          </div>
        </div>

        <div class="video-info fade-up fade-up-1">
          <div class="video-tag" id="video-tag">META ADS</div>
          <h1 class="video-title" id="video-title">Carregando vídeo...</h1>
          <div class="video-meta-row">
            <span class="video-meta-item">
              <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><path d="M12 8v4l2 2" stroke-linecap="round"/>
              </svg>
              <span id="video-duration">—</span>
            </span>
            <span class="video-meta-item">
              <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
              </svg>
              <span id="video-views">—</span>
            </span>
            <span class="video-meta-item">
              <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span id="video-level">—</span>
            </span>
          </div>

          <div class="video-actions fade-up fade-up-2">
            <!-- Save / Favorite -->
            <button class="action-btn fav" id="btn-save">
              <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.2">
                <path d="M12 21l-7.5-7.2A5 5 0 0 1 12 6.5a5 5 0 0 1 7.5 7.3L12 21z" stroke-linejoin="round"/>
              </svg>
              <span class="save-label">SALVAR</span>
            </button>

            <!-- Spacer pushes nav to the right -->
            <div class="nav-spacer"></div>

            <!-- Previous video — rendered by JS if applicable -->
            <button class="action-btn nav-btn" id="btn-prev" style="display:none;">
              <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path d="M15 18l-6-6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              ANTERIOR
            </button>

            <!-- Next video -->
            <button class="action-btn nav-btn" id="btn-next" style="display:none;">
              PRÓXIMO
              <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path d="M9 18l6-6-6-6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Playlist Column (right) -->
      <div class="playlist-col">
        <div class="playlist-header">
          <div class="playlist-accent"></div>
          <span class="playlist-title">Playlist</span>
          <span class="playlist-count" id="playlist-count"></span>
        </div>
        <div class="playlist-list" id="playlist-list">
          <!-- populated by JS -->
        </div>
      </div>

    </div>
  </div>

</div>

<script>
  // ── Catalog ────────────────────────────────────────────
  const CATALOG = [
    {
      id: 'x8_ZM5Ih_mg',
      title: 'Como criar novos top spenders — toda semana. @oraphaelpaiva',
      tag: 'META ADS',
      duration: '15:48',
      views: '1.6k visualizações',
      level: 'Avançado',
      cat: 'Meta Ads · Avançado',
    },
    {
      id: 'X_Wp8CBMSWQ',
      title: 'Atualização - 30.01.26',
      tag: 'META ADS',
      duration: '8:57',
      views: '2.5k visualizações',
      level: 'Intermediário',
      cat: 'Meta Ads · Intermediário',
    },
    {
      id: '9aG7QDu8Z6k',
      title: 'Outros modos e otimização',
      tag: 'META ADS',
      duration: '7:56',
      views: '4.6k visualizações',
      level: 'Avançado',
      cat: 'Meta Ads · Avançado',
    },
  ];

  // ── localStorage helpers ───────────────────────────────
  const FAV_KEY       = 'mbc_favorites';
  const WP_KEY        = 'mbc_watch_progress';
  const COMPLETED_KEY = 'mbc_completed';

  function getFavs()       { return JSON.parse(localStorage.getItem(FAV_KEY)       || '[]'); }
  function setFavs(arr)    { localStorage.setItem(FAV_KEY, JSON.stringify(arr)); }
  function getWP()         { return JSON.parse(localStorage.getItem(WP_KEY)        || '{}'); }
  function setWP(d)        { localStorage.setItem(WP_KEY, JSON.stringify(d)); }
  function getCompleted()  { return JSON.parse(localStorage.getItem(COMPLETED_KEY) || '{}'); }
  function markCompleted(id) {
    const c = getCompleted();
    c[id] = Date.now();
    localStorage.setItem(COMPLETED_KEY, JSON.stringify(c));
  }

  // ── Current video ──────────────────────────────────────
  const params = new URLSearchParams(location.search);
  const videoId = params.get('v') || CATALOG[0].id;
  const currentIndex = CATALOG.findIndex(v => v.id === videoId);
  const meta = currentIndex >= 0 ? CATALOG[currentIndex] : CATALOG[0];

  // ── Saved progress (for resume) ────────────────────────
  const savedWP = getWP()[videoId];
  const startSeconds = savedWP ? Math.floor(savedWP.currentTime) : 0;

  // ── Page meta ──────────────────────────────────────────
  document.title = meta.title + ' — The Media Buyer Club';
  document.getElementById('breadcrumb-title').textContent = meta.title;
  document.getElementById('video-tag').textContent = meta.tag;
  document.getElementById('video-title').textContent = meta.title;
  document.getElementById('video-duration').textContent = meta.duration;
  document.getElementById('video-views').textContent = meta.views;
  document.getElementById('video-level').textContent = meta.level;
  document.getElementById('playlist-count').textContent = (currentIndex + 1) + ' / ' + CATALOG.length;

  // ── Save / Favorite ────────────────────────────────────
  const btnSave = document.getElementById('btn-save');

  function updateSaveUI(saved) {
    const lbl = btnSave.querySelector('.save-label');
    const svg = btnSave.querySelector('svg');
    if (saved) {
      btnSave.classList.add('saved');
      svg.setAttribute('fill', 'currentColor');
      lbl.textContent = 'SALVO';
    } else {
      btnSave.classList.remove('saved');
      svg.setAttribute('fill', 'none');
      lbl.textContent = 'SALVAR';
    }
  }

  updateSaveUI(getFavs().includes(videoId));

  btnSave.addEventListener('click', () => {
    const favs = getFavs();
    const idx = favs.indexOf(videoId);
    if (idx >= 0) favs.splice(idx, 1); else favs.push(videoId);
    setFavs(favs);
    updateSaveUI(favs.includes(videoId));
  });

  // ── Prev / Next ────────────────────────────────────────
  const btnPrev = document.getElementById('btn-prev');
  const btnNext = document.getElementById('btn-next');

  if (currentIndex > 0) {
    btnPrev.style.display = 'inline-flex';
    btnPrev.addEventListener('click', () => {
      location.href = 'player.html?v=' + CATALOG[currentIndex - 1].id;
    });
  }
  if (currentIndex < CATALOG.length - 1) {
    btnNext.style.display = 'inline-flex';
    btnNext.addEventListener('click', () => {
      location.href = 'player.html?v=' + CATALOG[currentIndex + 1].id;
    });
  }

  // ── Build playlist ─────────────────────────────────────
  const playlistList  = document.getElementById('playlist-list');
  const completedData = getCompleted();

  // Show completed banner on load if already completed
  if (completedData[videoId]) {
    var banner = document.getElementById('completed-banner');
    if (banner) banner.style.display = 'flex';
  }

  CATALOG.forEach((v, i) => {
    const isActive    = v.id === videoId;
    const isDone      = !isActive && (v.id in completedData);
    const thumb       = `https://img.youtube.com/vi/${v.id}/hqdefault.jpg`;
    const href        = isActive ? '#' : `player.html?v=${v.id}`;

    let numContent;
    if (isActive) {
      numContent = '<svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><path d="M5 3l14 9-14 9V3z"/></svg>';
    } else if (isDone) {
      numContent = '<svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="#4ADE80" stroke-width="2.5"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    } else {
      numContent = (i + 1);
    }

    playlistList.innerHTML += `
      <a class="pitem${isActive ? ' active' : ''}" href="${href}" style="${isDone ? 'opacity:.75;' : ''}">
        <span class="pitem-num" style="${isDone ? 'color:#4ADE80;' : ''}">${numContent}</span>
        <div class="pitem-thumb">
          <img src="${thumb}" alt="${v.title}"
            onerror="this.src='https://placehold.co/100x56/0A1428/00D4C8?text=MBC'" />
          ${isActive ? '<div class="pitem-now"><div class="pitem-now-dot"></div></div>' : ''}
          ${isDone ? `<div style="position:absolute;inset:0;background:rgba(74,222,128,.08);display:flex;align-items:center;justify-content:center;">
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#4ADE80" stroke-width="2.5"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>` : ''}
        </div>
        <div class="pitem-info">
          <div class="pitem-cat">${isDone ? '<span style="color:#4ADE80;">✓ CONCLUÍDO</span>' : v.tag}</div>
          <div class="pitem-title">${v.title}</div>
          <div class="pitem-dur">${v.duration}</div>
        </div>
      </a>`;
  });

  // ── YouTube IFrame Player API ──────────────────────────
  // Progress tracking variables
  var ytPlayer;
  var progressInterval = null;

  // Save progress to localStorage
  function saveProgress() {
    if (!ytPlayer || typeof ytPlayer.getCurrentTime !== 'function') return;
    var currentTime = ytPlayer.getCurrentTime();
    var duration = ytPlayer.getDuration();
    if (!duration || currentTime < 30) return; // ignore first 30s
    var progress = currentTime / duration;
    var wp = getWP();
    if (progress >= 0.95) {
      // Treat as completed — remove from "in progress"
      delete wp[videoId];
    } else {
      wp[videoId] = {
        currentTime: currentTime,
        duration: duration,
        progress: progress,
        lastWatched: Date.now(),
      };
    }
    setWP(wp);
  }

  // YT API callback (must be global)
  window.onYouTubeIframeAPIReady = function() {
    ytPlayer = new YT.Player('yt-player', {
      videoId: videoId,
      playerVars: {
        autoplay: 1,
        rel: 0,
        modestbranding: 1,
        color: 'white',
        start: startSeconds, // resume from saved position
      },
      events: {
        onReady: function() {
          document.getElementById('video-loading').style.display = 'none';
        },
        onStateChange: function(e) {
          if (e.data === YT.PlayerState.PLAYING) {
            // Start periodic saving every 5s
            if (!progressInterval) {
              progressInterval = setInterval(saveProgress, 5000);
            }
          } else if (e.data === YT.PlayerState.PAUSED) {
            // Save immediately on pause
            saveProgress();
          } else if (e.data === YT.PlayerState.ENDED) {
            // Video finished — remove from progress, mark completed
            clearInterval(progressInterval);
            progressInterval = null;
            var wp = getWP();
            delete wp[videoId];
            setWP(wp);
            markCompleted(videoId);
            // Show completed banner
            var banner = document.getElementById('completed-banner');
            if (banner) banner.style.display = 'flex';
            // Update playlist item to show checkmark
            var pitem = document.querySelector('.pitem.active .pitem-num');
            if (pitem) pitem.innerHTML = '<svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="#4ADE80" stroke-width="2.5"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/></svg>';
          }
        },
      },
    });
  };

  // Save on page leave
  window.addEventListener('pagehide', saveProgress);
  window.addEventListener('beforeunload', saveProgress);

  // Load the YT IFrame API script
  (function() {
    var tag = document.createElement('script');
    tag.src = 'https://www.youtube.com/iframe_api';
    document.head.appendChild(tag);
  })();

  // ── Notifications ──────────────────────────────────────
  (function initNotifications() {
    const NOTIF_KEY = 'mbc_notif_read';
    const notifBtn  = document.querySelector('.notif-btn');
    const notifDot  = notifBtn.querySelector('.notif-dot');
    const notifRead = JSON.parse(localStorage.getItem(NOTIF_KEY) || '[]');
    const unreadIds = CATALOG.map(v => v.id).filter(id => !notifRead.includes(id));

    notifDot.style.display = unreadIds.length > 0 ? '' : 'none';

    const dd = document.createElement('div');
    dd.id = 'notif-dropdown';
    dd.style.cssText = [
      'display:none','position:absolute','top:calc(100% + 10px)','right:0',
      'width:320px','background:var(--surface-2)',
      'border:1px solid rgba(71,181,255,.14)','border-radius:10px',
      'box-shadow:0 20px 56px rgba(0,0,0,.75),0 0 0 1px rgba(0,212,200,.04)',
      'z-index:500','overflow:hidden',
    ].join(';');

    let html = `
      <div style="padding:14px 16px 10px;border-bottom:1px solid rgba(71,181,255,.07);display:flex;align-items:center;gap:8px;">
        <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="var(--teal)" stroke-width="2" style="flex-shrink:0;"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span style="font-family:'Roboto Mono',monospace;font-size:10px;font-weight:600;letter-spacing:.12em;color:var(--text-muted);flex:1;">NOTIFICAÇÕES</span>
        <button id="notif-mark-all" style="font-family:'Roboto Mono',monospace;font-size:9px;color:var(--teal);cursor:pointer;letter-spacing:.1em;background:none;border:none;padding:0;">MARCAR LIDAS</button>
      </div>
      <div style="max-height:340px;overflow-y:auto;">`;

    CATALOG.slice().reverse().forEach(v => {
      const isUnread = !notifRead.includes(v.id);
      const thumb    = `https://img.youtube.com/vi/${v.id}/hqdefault.jpg`;
      html += `
        <a href="player.html?v=${v.id}" data-nid="${v.id}"
           style="display:flex;align-items:center;gap:12px;padding:11px 16px;border-bottom:1px solid rgba(71,181,255,.05);text-decoration:none;background:${isUnread ? 'rgba(0,212,200,.035)' : 'transparent'};transition:background 150ms;"
           onmouseover="this.style.background='rgba(71,181,255,.06)'"
           onmouseout="this.style.background='${isUnread ? 'rgba(0,212,200,.035)' : 'transparent'}'">
          <div style="width:60px;min-width:60px;height:34px;border-radius:4px;overflow:hidden;background:var(--surface-3);">
            <img src="${thumb}" style="width:100%;height:100%;object-fit:cover;" onerror="this.parentElement.style.background='var(--surface-3)'" />
          </div>
          <div style="flex:1;min-width:0;">
            <div style="font-family:'Roboto Mono',monospace;font-size:8px;font-weight:700;letter-spacing:.14em;color:var(--teal);margin-bottom:3px;">NOVO VÍDEO</div>
            <div style="font-family:'Montserrat',sans-serif;font-size:12px;font-weight:600;color:var(--text-primary);line-height:1.3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${v.title}</div>
            <div style="font-family:'Roboto Mono',monospace;font-size:9px;color:var(--text-muted);margin-top:2px;">${v.cat}</div>
          </div>
          ${isUnread ? '<div style="width:7px;height:7px;border-radius:50%;background:var(--teal);box-shadow:0 0 8px var(--teal);flex-shrink:0;"></div>' : ''}
        </a>`;
    });

    html += '</div>';
    dd.innerHTML = html;
    notifBtn.appendChild(dd);

    let open = false;
    notifBtn.addEventListener('click', e => {
      e.stopPropagation();
      open = !open;
      dd.style.display = open ? 'block' : 'none';
    });
    document.addEventListener('click', e => {
      if (!notifBtn.contains(e.target)) { open = false; dd.style.display = 'none'; }
    });
    dd.querySelector('#notif-mark-all').addEventListener('click', e => {
      e.stopPropagation();
      localStorage.setItem(NOTIF_KEY, JSON.stringify(CATALOG.map(v => v.id)));
      notifDot.style.display = 'none';
      dd.querySelectorAll('[data-nid]').forEach(el => {
        el.style.background = 'transparent';
        el.onmouseout = () => { el.style.background = 'transparent'; };
        const dot = el.querySelector('div[style*="border-radius:50%"]');
        if (dot) dot.remove();
      });
    });
    dd.querySelectorAll('[data-nid]').forEach(el => {
      el.addEventListener('click', () => {
        const id   = el.dataset.nid;
        const read = JSON.parse(localStorage.getItem(NOTIF_KEY) || '[]');
        if (!read.includes(id)) { read.push(id); localStorage.setItem(NOTIF_KEY, JSON.stringify(read)); }
        if (CATALOG.every(v => read.includes(v.id))) notifDot.style.display = 'none';
      });
    });
  })();

  // ── Avatar: usuário real + logout ─────────────────────
  (async function initAvatar() {
    const avatar = document.querySelector('.avatar');
    if (!avatar) return;
    const { data: { user } } = await _sb.auth.getUser();
    if (user) {
      const initials = (user.user_metadata?.full_name || user.email).slice(0, 2).toUpperCase();
      avatar.textContent = initials;
    }
    avatar.style.cssText += ';position:relative;cursor:pointer;';

    const dd = document.createElement('div');
    dd.style.cssText = 'display:none;position:absolute;top:calc(100% + 8px);right:0;background:#111520;border:1px solid rgba(71,181,255,.12);border-radius:10px;box-shadow:0 16px 48px rgba(0,0,0,.7);z-index:500;min-width:210px;overflow:hidden;';
    dd.innerHTML = `
      <div style="padding:12px 16px;border-bottom:1px solid rgba(71,181,255,.07);">
        <div style="font-family:'Roboto Mono',monospace;font-size:9px;letter-spacing:.1em;color:#5B647A;margin-bottom:4px;">CONECTADO COMO</div>
        <div style="font-family:'Montserrat',sans-serif;font-size:12px;font-weight:600;color:#E8EDF5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${user ? user.email : ''}</div>
      </div>
      <button id="avatarLogoutBtn" style="width:100%;padding:12px 16px;background:none;border:none;display:flex;align-items:center;gap:10px;cursor:pointer;color:#FF8FA3;font-family:'Roboto Mono',monospace;font-size:10px;letter-spacing:.1em;" onmouseover="this.style.background='rgba(255,77,106,.06)'" onmouseout="this.style.background='none'">
        <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke-linecap="round" stroke-linejoin="round"/></svg>
        SAIR DA CONTA
      </button>`;
    avatar.appendChild(dd);

    let open = false;
    avatar.addEventListener('click', e => { e.stopPropagation(); open = !open; dd.style.display = open ? 'block' : 'none'; });
    document.addEventListener('click', () => { open = false; dd.style.display = 'none'; });
    dd.querySelector('#avatarLogoutBtn').addEventListener('click', async () => {
      await _sb.auth.signOut();
      window.location.replace('login.html');
    });
  })();
</script>

</body>
</html>
