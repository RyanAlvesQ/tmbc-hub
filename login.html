<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Media Buyer Club — Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;600&family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <style>
    /* ── Brand Tokens ─────────────────────────────────────── */
    :root {
      --teal:         #00D4C8;
      --teal-glow:    rgba(0,212,200,.22);
      --blue:         #47B5FF;
      --blue-glow:    rgba(71,181,255,.22);
      --dark-bg:      #07090F;
      --surface-1:    #0C0F1A;
      --surface-2:    #111520;
      --surface-3:    #181D2E;
      --orange:       #F5A623;
      --text-primary: #E8EDF5;
      --text-muted:   #5B647A;
      --text-dim:     #3A4259;
      --error:        #FF4D6A;
      --success:      #00D4C8;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html { scroll-behavior: smooth; }

    body {
      background-color: var(--dark-bg);
      color: var(--text-primary);
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    /* ── Noise texture ──────────────────────────────────── */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.035'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 9999;
      opacity: 0.55;
    }

    /* ── Ambient background glows ───────────────────────── */
    .bg-glow-teal {
      position: fixed;
      bottom: -120px;
      left: -80px;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(0,212,200,.14) 0%, transparent 65%);
      pointer-events: none;
      z-index: 0;
      animation: drift-teal 12s ease-in-out infinite;
    }
    .bg-glow-blue {
      position: fixed;
      top: -100px;
      right: -80px;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(71,181,255,.11) 0%, transparent 65%);
      pointer-events: none;
      z-index: 0;
      animation: drift-blue 15s ease-in-out infinite;
    }
    .bg-glow-center {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 800px;
      height: 400px;
      background: radial-gradient(ellipse, rgba(0,212,200,.03) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }
    @keyframes drift-teal {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(30px, -20px); }
    }
    @keyframes drift-blue {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-25px, 30px); }
    }

    /* ── Grid pattern ───────────────────────────────────── */
    .bg-grid {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(71,181,255,.025) 1px, transparent 1px),
        linear-gradient(90deg, rgba(71,181,255,.025) 1px, transparent 1px);
      background-size: 60px 60px;
      pointer-events: none;
      z-index: 0;
    }

    /* ── Main container ─────────────────────────────────── */
    .login-container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 440px;
      padding: 24px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 32px;
    }

    /* ── Logo area ──────────────────────────────────────── */
    .logo-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .logo-img {
      height: 64px;
      width: auto;
      object-fit: contain;
      filter: drop-shadow(0 0 20px rgba(0,212,200,.4));
    }
    .logo-tagline {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      font-weight: 500;
      letter-spacing: .22em;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    /* ── Card ───────────────────────────────────────────── */
    .card {
      width: 100%;
      background: var(--surface-2);
      border: 1px solid rgba(71,181,255,.1);
      border-radius: 16px;
      overflow: hidden;
      box-shadow:
        0 0 0 1px rgba(0,212,200,.04),
        0 8px 40px rgba(0,0,0,.6),
        0 32px 80px rgba(0,0,0,.3),
        inset 0 1px 0 rgba(255,255,255,.03);
    }

    .card-top-bar {
      height: 3px;
      background: linear-gradient(90deg, var(--teal) 0%, var(--blue) 60%, transparent 100%);
    }

    .card-body {
      padding: 36px 36px 32px;
    }

    /* ── View toggle (login / reset) ────────────────────── */
    .view { display: none; }
    .view.active { display: block; }

    /* ── Section label ──────────────────────────────────── */
    .section-label {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      font-weight: 500;
      letter-spacing: .2em;
      color: var(--teal);
      text-transform: uppercase;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section-label::before {
      content: '';
      width: 16px;
      height: 1px;
      background: var(--teal);
      display: block;
    }

    /* ── Headings ───────────────────────────────────────── */
    .card-title {
      font-family: 'Montserrat', sans-serif;
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
      line-height: 1.2;
      margin-bottom: 6px;
    }
    .card-subtitle {
      font-size: 13px;
      font-weight: 400;
      color: var(--text-muted);
      margin-bottom: 28px;
      line-height: 1.5;
    }

    /* ── Form fields ────────────────────────────────────── */
    .field-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 18px;
    }
    .field-label {
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: .1em;
      color: var(--text-muted);
      text-transform: uppercase;
    }
    .field-wrap {
      position: relative;
    }
    .field-input {
      width: 100%;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(71,181,255,.12);
      border-radius: 10px;
      padding: 12px 16px;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      outline: none;
      transition: border-color 200ms, background 200ms, box-shadow 200ms;
      letter-spacing: .01em;
    }
    .field-input::placeholder {
      color: var(--text-dim);
      font-weight: 400;
    }
    .field-input:focus {
      border-color: rgba(0,212,200,.4);
      background: rgba(0,212,200,.03);
      box-shadow: 0 0 0 3px rgba(0,212,200,.07), 0 0 20px rgba(0,212,200,.06);
    }
    .field-input.error {
      border-color: rgba(255,77,106,.4);
      box-shadow: 0 0 0 3px rgba(255,77,106,.07);
    }
    .field-input.has-icon { padding-right: 44px; }

    /* Password toggle */
    .eye-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      border-radius: 6px;
      transition: color 150ms;
    }
    .eye-btn:hover { color: var(--text-muted); }

    /* Field error message */
    .field-error {
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      color: var(--error);
      letter-spacing: .04em;
      display: none;
      margin-top: 4px;
    }
    .field-error.show { display: block; }

    /* ── Forgot password link ───────────────────────────── */
    .forgot-link {
      display: block;
      text-align: right;
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      letter-spacing: .06em;
      color: var(--blue);
      text-decoration: none;
      margin-top: -10px;
      margin-bottom: 24px;
      opacity: .8;
      transition: opacity 150ms, color 150ms;
    }
    .forgot-link:hover { opacity: 1; color: var(--teal); }

    /* ── Primary button ─────────────────────────────────── */
    .btn-primary {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(135deg, #00c4ba 0%, #00D4C8 50%, #1ae8da 100%);
      border: none;
      border-radius: 10px;
      font-family: 'Roboto Mono', monospace;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: .15em;
      color: #04201E;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: transform 150ms, box-shadow 150ms;
      box-shadow:
        0 4px 20px rgba(0,212,200,.3),
        0 0 40px rgba(0,212,200,.12);
    }
    .btn-primary::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,.15) 0%, transparent 60%);
      pointer-events: none;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow:
        0 6px 28px rgba(0,212,200,.4),
        0 0 60px rgba(0,212,200,.18);
    }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled {
      opacity: .5;
      cursor: not-allowed;
      transform: none;
    }
    .btn-primary .btn-spinner {
      display: none;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(4,32,30,.3);
      border-top-color: #04201E;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      margin: 0 auto;
    }
    .btn-primary.loading .btn-text { display: none; }
    .btn-primary.loading .btn-spinner { display: block; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ── Back link ──────────────────────────────────────── */
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      letter-spacing: .08em;
      color: var(--text-muted);
      text-decoration: none;
      margin-bottom: 24px;
      cursor: pointer;
      border: none;
      background: transparent;
      padding: 0;
      transition: color 150ms;
    }
    .back-link:hover { color: var(--blue); }

    /* ── Alert messages ─────────────────────────────────── */
    .alert {
      border-radius: 8px;
      padding: 12px 16px;
      font-family: 'Roboto Mono', monospace;
      font-size: 11px;
      letter-spacing: .04em;
      line-height: 1.5;
      margin-bottom: 20px;
      display: none;
    }
    .alert.show { display: block; }
    .alert-error {
      background: rgba(255,77,106,.08);
      border: 1px solid rgba(255,77,106,.2);
      color: #FF8FA3;
    }
    .alert-success {
      background: rgba(0,212,200,.08);
      border: 1px solid rgba(0,212,200,.2);
      color: var(--teal);
    }

    /* ── Divider ────────────────────────────────────────── */
    .or-divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 24px 0;
    }
    .or-divider::before,
    .or-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: rgba(71,181,255,.08);
    }
    .or-divider span {
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      letter-spacing: .1em;
      color: var(--text-dim);
    }

    /* ── Footer text ────────────────────────────────────── */
    .card-footer-text {
      text-align: center;
      margin-top: 20px;
      font-family: 'Roboto Mono', monospace;
      font-size: 10px;
      letter-spacing: .06em;
      color: var(--text-dim);
    }
    .card-footer-text a {
      color: var(--blue);
      text-decoration: none;
      opacity: .85;
      transition: opacity 150ms;
    }
    .card-footer-text a:hover { opacity: 1; }

    /* ── Bottom stamp ───────────────────────────────────── */
    .bottom-stamp {
      font-family: 'Roboto Mono', monospace;
      font-size: 9px;
      letter-spacing: .12em;
      color: var(--text-dim);
      text-align: center;
      opacity: .6;
    }

    /* ── Decorative corner lines ────────────────────────── */
    .corner-tl, .corner-br {
      position: fixed;
      width: 80px;
      height: 80px;
      pointer-events: none;
      z-index: 1;
    }
    .corner-tl {
      top: 20px; left: 20px;
      border-top: 1px solid rgba(0,212,200,.2);
      border-left: 1px solid rgba(0,212,200,.2);
    }
    .corner-br {
      bottom: 20px; right: 20px;
      border-bottom: 1px solid rgba(71,181,255,.2);
      border-right: 1px solid rgba(71,181,255,.2);
    }
  </style>
</head>
<body>

  <!-- Background decoration -->
  <div class="bg-glow-teal"></div>
  <div class="bg-glow-blue"></div>
  <div class="bg-glow-center"></div>
  <div class="bg-grid"></div>
  <div class="corner-tl"></div>
  <div class="corner-br"></div>

  <!-- Main layout -->
  <div class="login-container">

    <!-- Logo -->
    <div class="logo-area">
      <img class="logo-img" src="brand_assets/logo-transparent.png" alt="The Media Buyer Club" />
      <span class="logo-tagline">Área de Membros</span>
    </div>

    <!-- Card -->
    <div class="card">
      <div class="card-top-bar"></div>
      <div class="card-body">

        <!-- ══════════════════════════════════════════════ -->
        <!-- VIEW: LOGIN                                    -->
        <!-- ══════════════════════════════════════════════ -->
        <div class="view active" id="viewLogin">

          <div class="section-label">Acesso à área de membros</div>
          <h1 class="card-title">Bem-vindo de volta</h1>
          <p class="card-subtitle">Entre com suas credenciais para continuar</p>

          <!-- Login error alert -->
          <div class="alert alert-error" id="loginAlert"></div>

          <form id="loginForm" novalidate>

            <!-- Email -->
            <div class="field-group">
              <label class="field-label" for="loginEmail">E-mail</label>
              <div class="field-wrap">
                <input
                  class="field-input"
                  id="loginEmail"
                  type="email"
                  placeholder="seu@email.com"
                  autocomplete="email"
                  required
                />
              </div>
              <span class="field-error" id="loginEmailError">Insira um e-mail válido.</span>
            </div>

            <!-- Password -->
            <div class="field-group">
              <label class="field-label" for="loginPassword">Senha</label>
              <div class="field-wrap">
                <input
                  class="field-input has-icon"
                  id="loginPassword"
                  type="password"
                  placeholder="••••••••"
                  autocomplete="current-password"
                  required
                />
                <button type="button" class="eye-btn" id="toggleLoginPwd" aria-label="Mostrar senha">
                  <!-- Eye icon -->
                  <svg id="eyeIconShow" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                  <!-- Eye-off icon (hidden by default) -->
                  <svg id="eyeIconHide" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="display:none">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="1" y1="1" x2="23" y2="23" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
              <span class="field-error" id="loginPasswordError">A senha deve ter pelo menos 6 caracteres.</span>
            </div>

            <!-- Forgot password -->
            <a class="forgot-link" id="showReset" href="#">Esqueci minha senha</a>

            <!-- Submit -->
            <button type="submit" class="btn-primary" id="loginBtn">
              <span class="btn-text">ENTRAR</span>
              <span class="btn-spinner"></span>
            </button>

          </form>

        </div>
        <!-- /VIEW LOGIN -->

        <!-- ══════════════════════════════════════════════ -->
        <!-- VIEW: RESET PASSWORD                          -->
        <!-- ══════════════════════════════════════════════ -->
        <div class="view" id="viewReset">

          <button class="back-link" id="showLogin">
            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 5l-7 7 7 7" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            VOLTAR AO LOGIN
          </button>

          <div class="section-label">Recuperação de acesso</div>
          <h1 class="card-title">Redefinir senha</h1>
          <p class="card-subtitle">Insira seu e-mail e enviaremos um link para criar uma nova senha.</p>

          <!-- Reset alerts -->
          <div class="alert alert-error"   id="resetAlertError"></div>
          <div class="alert alert-success" id="resetAlertSuccess"></div>

          <form id="resetForm" novalidate>

            <div class="field-group">
              <label class="field-label" for="resetEmail">E-mail cadastrado</label>
              <div class="field-wrap">
                <input
                  class="field-input"
                  id="resetEmail"
                  type="email"
                  placeholder="seu@email.com"
                  autocomplete="email"
                  required
                />
              </div>
              <span class="field-error" id="resetEmailError">Insira um e-mail válido.</span>
            </div>

            <button type="submit" class="btn-primary" id="resetBtn">
              <span class="btn-text">ENVIAR LINK DE REDEFINIÇÃO</span>
              <span class="btn-spinner"></span>
            </button>

          </form>

          <p class="card-footer-text" style="margin-top:24px">
            Lembrou a senha?
            <a href="#" id="showLoginFromReset">Voltar ao login</a>
          </p>

        </div>
        <!-- /VIEW RESET -->

        <!-- ══════════════════════════════════════════════ -->
        <!-- VIEW: NOVA SENHA (após clicar no link de reset) -->
        <!-- ══════════════════════════════════════════════ -->
        <div class="view" id="viewNewPassword">

          <div class="section-label">Nova senha</div>
          <h1 class="card-title">Criar nova senha</h1>
          <p class="card-subtitle">Escolha uma senha segura para sua conta.</p>

          <div class="alert alert-error"   id="newPwdAlertError"></div>
          <div class="alert alert-success" id="newPwdAlertSuccess"></div>

          <form id="newPwdForm" novalidate>

            <div class="field-group">
              <label class="field-label" for="newPwd">Nova Senha</label>
              <div class="field-wrap">
                <input class="field-input" id="newPwd" type="password" placeholder="Mínimo 8 caracteres" autocomplete="new-password" required />
              </div>
              <span class="field-error" id="newPwdError">A senha deve ter pelo menos 8 caracteres.</span>
            </div>

            <div class="field-group">
              <label class="field-label" for="newPwdConfirm">Confirmar Senha</label>
              <div class="field-wrap">
                <input class="field-input" id="newPwdConfirm" type="password" placeholder="Repita a nova senha" autocomplete="new-password" required />
              </div>
              <span class="field-error" id="newPwdConfirmError">As senhas não coincidem.</span>
            </div>

            <button type="submit" class="btn-primary" id="newPwdBtn">
              <span class="btn-text">SALVAR NOVA SENHA</span>
              <span class="btn-spinner"></span>
            </button>

          </form>

        </div>
        <!-- /VIEW NOVA SENHA -->

      </div>
    </div>
    <!-- /Card -->

    <p class="bottom-stamp">© 2025 THE MEDIA BUYER CLUB · TODOS OS DIREITOS RESERVADOS</p>

  </div>

  <script>
    // ── Supabase Client ────────────────────────────────────
    const SUPABASE_URL  = 'https://reyogxnhguludddatyja.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJleW9neG5oZ3VsdWRkZGF0eWphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MDcyMjMsImV4cCI6MjA4NzI4MzIyM30.ehSy3Kx38jKpNqU0xZZnxSlDGharwMReulpRT_-vlVI';
    const _sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    // ── View references ─────────────────────────────────────
    const viewLogin       = document.getElementById('viewLogin');
    const viewReset       = document.getElementById('viewReset');
    const viewNewPassword = document.getElementById('viewNewPassword');

    function showView(view) {
      [viewLogin, viewReset, viewNewPassword].forEach(v => v.classList.remove('active'));
      view.classList.add('active');
    }

    // ── Error mapping (pt-BR) ───────────────────────────────
    function mapError(msg) {
      if (!msg) return 'Ocorreu um erro. Tente novamente.';
      if (msg.includes('Invalid login credentials'))  return 'E-mail ou senha incorretos.';
      if (msg.includes('Email not confirmed'))         return 'Confirme seu e-mail antes de entrar.';
      if (msg.includes('Too many requests'))           return 'Muitas tentativas. Aguarde alguns minutos.';
      if (msg.includes('User not found'))              return 'Usuário não encontrado.';
      if (msg.includes('Password should be'))          return 'A senha deve ter pelo menos 6 caracteres.';
      if (msg.includes('Unable to validate'))          return 'Sessão expirada. Solicite um novo link.';
      if (msg.includes('same password'))               return 'A nova senha deve ser diferente da atual.';
      return msg;
    }

    // ── On load: redirecionar se já logado / detectar recovery ──
    (async function() {
      const isRecovery = window.location.hash.includes('type=recovery');
      const { data: { session } } = await _sb.auth.getSession();

      if (isRecovery && session) {
        history.replaceState(null, '', window.location.pathname);
        showView(viewNewPassword);
        return;
      }
      if (session) {
        window.location.replace('index.html');
      }
    })();

    // ── View switching ──────────────────────────────────────
    document.getElementById('showReset').addEventListener('click', (e) => {
      e.preventDefault();
      clearAlerts();
      showView(viewReset);
    });
    document.getElementById('showLogin').addEventListener('click', () => {
      clearAlerts();
      showView(viewLogin);
    });
    document.getElementById('showLoginFromReset').addEventListener('click', (e) => {
      e.preventDefault();
      clearAlerts();
      showView(viewLogin);
    });

    if (window.location.hash === '#reset') showView(viewReset);

    // ── Password visibility toggle ──────────────────────────
    document.getElementById('toggleLoginPwd').addEventListener('click', () => {
      const input    = document.getElementById('loginPassword');
      const iconShow = document.getElementById('eyeIconShow');
      const iconHide = document.getElementById('eyeIconHide');
      const isPass   = input.type === 'password';
      input.type     = isPass ? 'text' : 'password';
      iconShow.style.display = isPass ? 'none' : '';
      iconHide.style.display = isPass ? ''     : 'none';
    });

    // ── Helpers ─────────────────────────────────────────────
    function setFieldError(inputEl, errorEl, show) {
      inputEl.classList.toggle('error', show);
      errorEl.classList.toggle('show', show);
    }
    function clearAlerts() {
      ['loginAlert','resetAlertError','resetAlertSuccess','newPwdAlertError','newPwdAlertSuccess'].forEach(id => {
        const el = document.getElementById(id);
        if (el) { el.classList.remove('show'); el.textContent = ''; }
      });
    }
    function setButtonLoading(btn, loading) {
      btn.classList.toggle('loading', loading);
      btn.disabled = loading;
    }

    // ── LOGIN ───────────────────────────────────────────────
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email    = document.getElementById('loginEmail');
      const password = document.getElementById('loginPassword');
      let valid = true;

      const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim());
      setFieldError(email, document.getElementById('loginEmailError'), !emailOk);
      if (!emailOk) valid = false;

      const passOk = password.value.length >= 6;
      setFieldError(password, document.getElementById('loginPasswordError'), !passOk);
      if (!passOk) valid = false;

      if (!valid) return;

      const loginBtn   = document.getElementById('loginBtn');
      const loginAlert = document.getElementById('loginAlert');
      setButtonLoading(loginBtn, true);
      loginAlert.classList.remove('show');

      try {
        const { data, error } = await _sb.auth.signInWithPassword({
          email: email.value.trim(),
          password: password.value,
        });
        if (error) throw error;
        window.location.replace('index.html');
      } catch (err) {
        loginAlert.textContent = mapError(err.message);
        loginAlert.className   = 'alert alert-error show';
        setButtonLoading(loginBtn, false);
      }
    });

    // ── RESET PASSWORD ──────────────────────────────────────
    document.getElementById('resetForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const resetEmail = document.getElementById('resetEmail');
      const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(resetEmail.value.trim());
      setFieldError(resetEmail, document.getElementById('resetEmailError'), !emailOk);
      if (!emailOk) return;

      const resetBtn = document.getElementById('resetBtn');
      setButtonLoading(resetBtn, true);
      document.getElementById('resetAlertError').classList.remove('show');
      document.getElementById('resetAlertSuccess').classList.remove('show');

      try {
        const { error } = await _sb.auth.resetPasswordForEmail(
          resetEmail.value.trim(),
          { redirectTo: window.location.origin + '/login.html' }
        );
        if (error) throw error;

        const success = document.getElementById('resetAlertSuccess');
        success.textContent = 'Link enviado! Verifique sua caixa de entrada e a pasta de spam.';
        success.classList.add('show');
        resetBtn.disabled = true;
        resetBtn.querySelector('.btn-text').style.display    = '';
        resetBtn.querySelector('.btn-spinner').style.display = 'none';
      } catch (err) {
        const errAlert = document.getElementById('resetAlertError');
        errAlert.textContent = mapError(err.message);
        errAlert.classList.add('show');
        setButtonLoading(resetBtn, false);
      }
    });

    // ── NOVA SENHA (após recovery link) ────────────────────
    document.getElementById('newPwdForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const newPwd    = document.getElementById('newPwd');
      const newPwdCfm = document.getElementById('newPwdConfirm');
      let valid = true;

      const pwdOk = newPwd.value.length >= 8;
      setFieldError(newPwd, document.getElementById('newPwdError'), !pwdOk);
      if (!pwdOk) valid = false;

      const matchOk = newPwd.value === newPwdCfm.value;
      setFieldError(newPwdCfm, document.getElementById('newPwdConfirmError'), !matchOk);
      if (!matchOk) valid = false;

      if (!valid) return;

      const newPwdBtn = document.getElementById('newPwdBtn');
      setButtonLoading(newPwdBtn, true);
      document.getElementById('newPwdAlertError').classList.remove('show');

      try {
        const { error } = await _sb.auth.updateUser({ password: newPwd.value });
        if (error) throw error;

        const success = document.getElementById('newPwdAlertSuccess');
        success.textContent = 'Senha atualizada! Redirecionando...';
        success.classList.add('show');
        setTimeout(() => window.location.replace('index.html'), 2000);
      } catch (err) {
        const errAlert = document.getElementById('newPwdAlertError');
        errAlert.textContent = mapError(err.message);
        errAlert.classList.add('show');
        setButtonLoading(newPwdBtn, false);
      }
    });
  </script>
</body>
</html>
